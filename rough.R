normTest = sampleTest
normTrain = sampleTrain

normTrain$Class = NULL
normTest$Class = NULL

library(caret)
pre = preProcess(normTrain)
normTrain = predict(pre,normTrain)
pre = preProcess(normTest)
normTest = predict(pre,normTest)

km = kmeans(normTrain, centers=9,iter.max=1000)
table(sampleTrain$Class)
table(kmc$cluster)

lapply(split(sampleTrain,clusterTrain),function(x){
  x$Class= as.factor(x$Class)
  rf = randomForest(Class~.,data=x)
  pred = predict(rf,newdata=sampleTest1,type="prob")
  table(sampleTest1$Class,pred[,2]>0.5)
})

sampleTrain1  = subset(sampleTrain,clusterTrain==1)
sampleTrain2  = subset(sampleTrain,clusterTrain==2)
sampleTrain3  = subset(sampleTrain,clusterTrain==3)
sampleTrain4  = subset(sampleTrain,clusterTrain==4)
sampleTrain5  = subset(sampleTrain,clusterTrain==5)
sampleTrain6  = subset(sampleTrain,clusterTrain==6)
sampleTrain7  = subset(sampleTrain,clusterTrain==7)
sampleTrain8  = subset(sampleTrain,clusterTrain==8)
sampleTrain9  = subset(sampleTrain,clusterTrain==9)

sampleTest1  = subset(sampleTest,clusterTest==1)
sampleTest2  = subset(sampleTest,clusterTest==2)
sampleTest3  = subset(sampleTest,clusterTest==3)
sampleTest4  = subset(sampleTest,clusterTest==4)
sampleTest5  = subset(sampleTest,clusterTest==5)
sampleTest6  = subset(sampleTest,clusterTest==6)
sampleTest7  = subset(sampleTest,clusterTest==7)
sampleTest8  = subset(sampleTest,clusterTest==8)
sampleTest9  = subset(sampleTest,clusterTest==9)

library(randomForest)
sampleTrain1$Class=as.factor(sampleTrain1$Class)
sampleTrain2$Class=as.factor(sampleTrain2$Class)
sampleTrain3$Class=as.factor(sampleTrain3$Class)
sampleTrain4$Class=as.factor(sampleTrain4$Class)
sampleTrain5$Class=as.factor(sampleTrain5$Class)
sampleTrain6$Class=as.factor(sampleTrain6$Class)
sampleTrain7$Class=as.factor(sampleTrain7$Class)
sampleTrain8$Class=as.factor(sampleTrain8$Class)
sampleTrain9$Class=as.factor(sampleTrain9$Class)

rf1 = randomForest(Class~.,data=sampleTrain1)
rf2 = randomForest(Class~.,data=sampleTrain2)
rf3 = randomForest(Class~.,data=sampleTrain3)
rf4 = randomForest(Class~.,data=sampleTrain4)
rf5 = randomForest(Class~.,data=sampleTrain5)
rf6 = randomForest(Class~.,data=sampleTrain6)
rf7 = randomForest(Class~.,data=sampleTrain7)
rf8 = randomForest(Class~.,data=sampleTrain8)
rf9 = randomForest(Class~.,data=sampleTrain9)


pred1= predict(rf1,newdata=sampleTest1,type="prob")
pred2= predict(rf2,newdata=sampleTest2,type="prob")

-V5-V7-V8-V9-V11-V19-V21-V22-V23-V28-V29-V35
normtrain = normTrain[c(setdiff(names(normTrain),c('V5','V7','V8','V9','V11','V19','V21','V22','V23','V28','V29','V35')))]
